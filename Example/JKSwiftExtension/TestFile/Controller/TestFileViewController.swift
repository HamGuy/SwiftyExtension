//
//  TestFileViewController.swift
//  JKSwiftExtension_Example
//
//  Created by IronMan on 2020/11/25.
//  Copyright ¬© 2020 CocoaPods. All rights reserved.
//

import UIKit
import Dispatch
import JKSwiftExtension
import CoreTelephony

class TestFileViewController: BaseViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        
        self.title = "TestFile"
        
        headDataArray = ["‰∏Ä„ÄÅÂü∫Êú¨ÁöÑ‰ΩøÁî®"]
        dataArray = [["ËÆæÁΩÆÊúâÂÜÖËæπË∑ùÁöÑlabel", "ËÆæÁΩÆÊúâÂÜÖËæπË∑ùÁöÑlabel", "ËÆæÁΩÆÊúâÂÜÖËæπË∑ùÁöÑlabel", "ËÆæÁΩÆÊúâÂÜÖËæπË∑ùÁöÑlabel", "ËÆæÁΩÆÊúâÂÜÖËæπË∑ùÁöÑlabel", "Êï∞ÁªÑÊµãËØï", "struct", "test", "9", "ÁΩëÁªúÊùÉÈôêÁöÑÂà§Êñ≠"]]
        if #available(iOS 11.0, *) {
            let window = UIApplication.shared.windows.filter {$0.isKeyWindow}.first
            let topPadding = window?.safeAreaInsets.top
            
            //Áä∂ÊÄÅÊ†èÈ´òÂ∫¶
            let statusBarHeight = UIApplication.shared.statusBarFrame.height;
            debugPrint("È°∂ÈÉ®Ë∑ùÁ¶ªÔºö\(topPadding ?? 0) Áä∂ÊÄÅÊ†èÈ´òÂ∫¶Ôºö\(statusBarHeight)")
        }
        
        /*
         var userInfo: [String: Any] = ["firstName": "Â§ßÂ∏Ö",
         "school": "St. Primary School"]
         debugPrint("Original User Info: \(userInfo)")
         // creating a new dictionary with other info
         let otherInfo: [String: Any] = ["country": "USA",
         "school": "Ê≤≥Âçó",
         "pincode": 6783456]
         userInfo = userInfo.merging(otherInfo, uniquingKeysWith: { current, _ in
         return current
         })
         debugPrint("Updated User Info: \(userInfo)")
         */
    }
    
    deinit {
        debugPrint("----------")
    }
}

enum Rank: String, CaseIterable {
    case One = "11"
    case Two = "22"
    static let allValues = Rank.allCases.map { $0.rawValue }
}

extension TestFileViewController {
    
    /// ËÆ°ÁÆóxÁöÑnÊ¨°Êñπ
    /// - Parameters:
    ///   - x: ÂÄº
    ///   - n: Ê¨°Êñπ
    /// - Returns: ÁªìÊûú
    func sum(x: Double, n: Int) -> Double {
        if (n == 0) {
            return 1
        }
        // ËøôÈáåÈáçÂ§çÂà©Áî®‰∫ÜtÁöÑËµÑÊ∫ê
        let t = sum(x: x, n: n / 2)
        if (n % 2 == 1) {
            // Â¶ÇÊûúnÊòØÂ•áÊï∞
            // ËøôÈáåÂ§ö‰∫Ü‰∏Ä‰∏™xÔºåÂõ†‰∏∫ÔºöÂ¶ÇÊûúnÊòØ17ÔºåtÁöÑÁªìÊûúÊòØ8Ê¨°ÂêéÁöÑÔºå2‰∏™tÂ∞±ÊòØ16Ê¨°ÔºåÂ∞ë‰∫Ü‰∏ÄÊ¨°
            return t * t * x
        } else {
            // nÊòØÂÅ∂Êï∞
            // Â¶ÇÊûúnÊòØ16,tÁöÑÁªìÊûúÊòØ8Ê¨°ÂêéÁöÑÔºå2‰∏™t‰πüÂ∞±ÊòØ16Ê¨°ÔºåÂàöÂàöÂ•Ω
            return t * t
        }
    }
    
    func isMultiple(_ a: Int, of b: Int) -> Bool {
        return a.isMultiple(of: b)
    }
    
    
    @objc func test110() {
        /*
         debugPrint("ÂºÄÂßã----")
         let isNetworkPermissions = isNetworkPermissions()
         debugPrint("ÊòØÂê¶ÊúâÁΩëÁªúÁöÑÊùÉÈôêÔºö\(isNetworkPermissions)")
         debugPrint("ÁªìÊùü----")
         */
        let text = "ÂìàÂìà üòÑ"
        var count = 0
        var endString: String = ""
        for i in 0...text.count - 1 {
            let c: unichar = (text as NSString).character(at: i)
            var cLength = 0
            endString = endString + "\(c)"
            debugPrint("cÔºö\(c)")
        }
        
        for character in text {
            debugPrint("character:\(character)")
        }
        debugPrint("endStringÔºö\(endString)")
    }
    
    /// Âà§Êñ≠ÁΩëÁªúÊòØÂê¶ÊúâÊùÉÈôê
    private func isNetworkPermissions() -> Bool {
        var isNetworkPermissions:Bool = false
        let cellularData = CTCellularData()
        /// Á∫øÁ®ã‰ø°Âè∑Èáè
        let semaphore = DispatchSemaphore(value: 0)
        cellularData.cellularDataRestrictionDidUpdateNotifier = { state in
            if state == .notRestricted {
                isNetworkPermissions = true
            } else  {
                isNetworkPermissions = false
            }
            semaphore.signal()
        }
        semaphore.wait()
        return isNetworkPermissions
    }
    
    @objc func test109() {
        /*
         debugPrint(isMultiple(10, of: 5))
         debugPrint(isMultiple(0, of: 1))
         debugPrint(isMultiple(1, of: 3))
         debugPrint(isMultiple(5, of: 10))
         debugPrint(isMultiple(8, of: 16))
         */
        if #available(iOS 13, *) {
            self.navigationController?.pushViewController(SegmentViewController(), animated: true)
        }
    }
    
    
    @objc func test108() {
        self.navigationController?.pushViewController(MapKitTestViewController(), animated: true)
    }
    
    @objc func test107() {
        //var array1 = ["a", "b", "c"]
        // ‰πü‰∏çÂèØ‰ª•Ë∂äÁïå
        //array1.insert("yy", at: 0)
        //print(array1)
        //let oldString = "12345678"
        
        //
        //        let value1 = 2 << 0b0001 // 0100
        //        let value2 = 4 << 0b0001 // 1000
        //        let value3 = value1 & value2
        //        let value4 = value1 | value2
        //        let value5 = 0o120
        //        debugPrint("value5:\(value5)")
        
        //        let value1 = 0b0001 << 1 //  0010
        //        let value2 = 0b0001 << 2 //  0100
        //        let value3 = 0b0001 << 3 //  1000
        //        let value4 = 0b0001 << 4 // 10000
        
        //        let value1 = 3 << 1 //  0010  0011 -> 0110    = 6
        //        let value2 = 3 << 2 //  0100       -> 1100    = 12
        //        let value3 = 3 << 3 //  1000       -> 11000   = 24
        //        let value4 = 3 << 4 // 10000       -> 110000  = 48
        
        // debugPrint("value1: \(value1)", "value2: \(value2)", "value3: \(value3)", "value4: \(value4)")
        //        let numberData = 4096
        //        let value = numberData & 0x1100
        //        debugPrint("ÁªìÊûúÔºö\(value)")
        let status: UInt8 = ~(1 << 3)         // 00001000 11110111
        let x: Int = 0b10001001 & Int(status) // 10001001 10001001  10000001
        // 1101  841
        debugPrint("x:\(x) status:\(status)")
    }
    
    @objc func test106() {
        // self.navigationController?.pushViewController(JKVVViewController(), animated: true)
        let array1 = [1, 2, 2, 5]
        let array2 = [1, 6, 2]
        debugPrint("-1--start-:\(CFAbsoluteTimeGetCurrent())")
        var dict1: [String:Int] = [:]
        array1.forEach({
            dict1["\($0)"] = 1
        })
        array2.forEach({
            if 1 == dict1["\($0)"] {
                //Ê≠§Â§Ñ‰æøÂèØÂèñÂà∞Áõ∏ÂêåÂÖÉÁ¥†
                debugPrint("Áõ∏ÂêåÁöÑÂÖÉÁ¥†Ôºö\($0)")
            }
        })
        debugPrint("-1--end-:\(CFAbsoluteTimeGetCurrent())")
    }
    
    @objc func test105() {
        let numbers1 = ["1", "2", "4"]
        let numbers2 = ["1", "2", "3"]
        let numbers3 = ["1", "2", "3"]
        debugPrint("numbers1ÊòØÂê¶Á≠â‰∫énumbers2Ôºö\(numbers1 == numbers2)\n numbers2ÊòØÂê¶Á≠â‰∫énumbers3Ôºö\(numbers2 == numbers3)")
        self.navigationController?.pushViewController(NineViewController(), animated: true)
    }
    
    @objc func test104() {
        let numbers = [1,2, nil,4]
        let result = numbers.compactMap{ $0 } //[16, 64, 4]
        print(result)  // [3,4,5,6]
    }
    
    @objc func test103() {
        self.navigationController?.pushViewController(LanePicViewController(), animated: true)
    }
    
    @objc func test102() {
        // showAlertAgreement()
        /*
         var sectionModels = [[11, 12, 13], [21, 22, 23]]
         debugPrint("Êï∞ÁªÑÔºö\(sectionModels)")
         //var items = sectionModels[0]
         // items.remove(at: 1)
         sectionModels[0].removeAll(where: { $0  == 12 })
         debugPrint("ÁßªÈô§ÂêéÊï∞ÁªÑÔºö\(sectionModels)")
         */
        //        let colors = Rank.allValues
        //        print(colors)
        let value1 = 0b0
        let value2 = 0b10 << 1
        let value3 = 0b10 << 3
        let value4 = value1 | value2 | value3
        debugPrint("value4Ôºö\(value4)")
    }
    
    @objc func test101() {
        /*
         // self.navigationController?.pushViewController(RadiusViewController(), animated: true)
         debugPrint("ÂºÄÂßã")
         DispatchQueue.global().async {
         /// ÂàùÂßãÂåñÂÄº S = 0
         let semaphore = DispatchSemaphore(value: 0)
         for index in 0..<4 {
         /// S = 0 - 1ÔºåS = -1, ËøõÁ®ãÈòªÂ°ûÂπ∂ËøõÂÖ•Á≠âÂæÖÈòüÂàó
         DispatchQueue.global().async {
         print(index)
         Thread.sleep(forTimeInterval: 3)
         DispatchQueue.main.async {
         /// S = -1 + 1ÔºåS = 0, Âî§ÈÜíÂØπÂ∫îÁöÑÁ≠âÂæÖËøõÁ®ãÔºåÂπ∂ÁªßÁª≠ÊâßË°å
         semaphore.signal()
         }
         }
         semaphore.wait()
         }
         DispatchQueue.main.async {
         debugPrint("ÂÖ®ÈÉ®ÊâßË°åÂÆåÊØï")
         }
         }
         debugPrint("ÁªìÊùü")
         */
        
        let originalString = "123"
        let targetLength = 20
        let paddingCharacter = "0"
        
        let paddedString = String(repeating: paddingCharacter, count: targetLength - originalString.count) + originalString
        debugPrint(paddedString) // ËæìÂá∫ÁªìÊûúÔºö00000000000000000123
    }
    
    //MARK: ‰∏ä‰º†ÂõæÁâá
    /// ‰∏ä‰º†ÂõæÁâáÔºåÂéãÁº©Âú®ÂÜÖÈÉ®Áªü‰∏ÄÂ§ÑÁêÜ
    //MARK: ‰∏ä‰º†ÂõæÁâá
    /// ‰∏ä‰º†ÂõæÁâáÔºåÂéãÁº©Âú®ÂÜÖÈÉ®Áªü‰∏ÄÂ§ÑÁêÜ
    func uploadImageResurce() {
        
        // ÂàõÂª∫Ë∞ÉÂ∫¶ÁªÑ
        let workingGroup = DispatchGroup()
        // ÂàõÂª∫Â§öÂàó
        let workingQueue = DispatchQueue.global()
        let images = [1, 2, 3, 4, 5, 6]
        var imageUrls = images.map { _ in
            ""
        }
        // ÊúÄÂàùÁöÑurlÊï∞ÁªÑ
        debugPrint("ÊúÄÂàùÁöÑurlÊï∞ÁªÑÔºö\(imageUrls)")
        // var a: Int = 0
        for (index, image) in images.enumerated() {
            
            workingGroup.enter()
            JKAsyncs.asyncDelay(index == 2 ? 5 : 1) {
            } _: {
                debugPrint("Êé•Âè£ \(index) Êï∞ÊçÆËØ∑Ê±ÇÂÆåÊàê ÂÄºÔºö\(image)")
                imageUrls[index] = "\(image)"
                workingGroup.leave()
            }
            //            a = a + 1
            //            // ÂÖ•ÁªÑ
            //            if a == 2 {
            //                break
            //            }
        }
        // Ë∞ÉÂ∫¶ÁªÑÈáåÁöÑ‰ªªÂä°ÈÉΩÊâßË°åÂÆåÊØï
        workingGroup.notify(queue: workingQueue, execute: {
            // ÂÖ®ÈÉ®
            debugPrint("ÂÖ®ÈÉ®ÁªìÊùü, ÁîüÊàêÁöÑurlÔºö\(imageUrls)")
        })
    }
    
    //MARK: ‰∏ä‰º†ÂõæÁâá
    /// ‰∏ä‰º†ÂõæÁâáÔºåÂéãÁº©Âú®ÂÜÖÈÉ®Áªü‰∏ÄÂ§ÑÁêÜ
    //MARK: ‰∏ä‰º†ÂõæÁâá
    /// ‰∏ä‰º†ÂõæÁâáÔºåÂéãÁº©Âú®ÂÜÖÈÉ®Áªü‰∏ÄÂ§ÑÁêÜ
    func uploadImageResurce1() {
        
        // ÂàõÂª∫Ë∞ÉÂ∫¶ÁªÑ
        let workingGroup = DispatchGroup()
        // ÂàõÂª∫Â§öÂàó
        let workingQueue = DispatchQueue.global()
        
        debugPrint("ÂºÄÂßãÊâßË°åÁöÑ‰ª£Á†Å")
        
        workingGroup.enter()
        JKAsyncs.asyncDelay(5) {
        } _: {
            debugPrint("Êé•Âè£1ÊâßË°åÁªìÊùü")
            workingGroup.leave()
        }
        
        workingGroup.enter()
        JKAsyncs.asyncDelay(2) {
            debugPrint("")
        } _: {
            debugPrint("Êé•Âè£2ÊâßË°åÁªìÊùü")
            workingGroup.leave()
        }
        
        // Ë∞ÉÂ∫¶ÁªÑÈáåÁöÑ‰ªªÂä°ÈÉΩÊâßË°åÂÆåÊØï
        workingGroup.notify(queue: workingQueue, execute: {
            // ÂÖ®ÈÉ®
            debugPrint("ÂÖ®ÈÉ®ÁªìÊùü")
        })
        debugPrint("ÊúÄÂêéÁöÑ‰ª£Á†Å")
    }
    
    func uploadImageResurce2() {
        
        // ÂàõÂª∫Ë∞ÉÂ∫¶ÁªÑ
        let workingGroup = DispatchGroup()
        // ÂàõÂª∫Â§öÂàó
        let workingQueue = DispatchQueue.global()
        
        var result: Bool = false
        debugPrint("ÂºÄÂßãÊâßË°åÁöÑ‰ª£Á†Å")
        workingGroup.enter()
        netWork1 {
            debugPrint("Êé•Âè£1ÊâßË°åÁªìÊùü")
            result = false
            workingGroup.leave()
        }
        
        workingGroup.enter()
        netWork2 {
            result = true
            debugPrint("Êé•Âè£2ÊâßË°åÁªìÊùü")
            workingGroup.leave()
        }
        
        // Ë∞ÉÂ∫¶ÁªÑÈáåÁöÑ‰ªªÂä°ÈÉΩÊâßË°åÂÆåÊØï
        workingGroup.notify(queue: workingQueue, execute: {
            // ÂÖ®ÈÉ®
            debugPrint("ÂÖ®ÈÉ®ÁªìÊùü: \(result)")
        })
        debugPrint("ÊúÄÂêéÁöÑ‰ª£Á†Å")
    }
    
    func netWork1(finishClosure: @escaping (() -> Void)) {
        JKAsyncs.asyncDelay(10) {
        } _: {
            finishClosure()
        }
    }
    
    func netWork2(finishClosure: @escaping (() -> Void)) {
        JKAsyncs.asyncDelay(3) {
        } _: {
            finishClosure()
        }
    }
}

extension String {
    // Ê∑ªÂä†ÂçÉÂàÜ‰ΩçÔºåÂ∞èÊï∞ÁÇπÂêéÈù¢‰øùÁïô‰∏â‰ΩçÔºåÈªòËÆ§ÂõõËàç‰∫îÂÖ•
    func tradeAmountAddCommaString(maximumFractionDigits: Int = 2, minimumFractionDigits: Int = 2, roundingModel: NumberFormatter.RoundingMode = .up, numberStyle: NumberFormatter.Style = .none) -> String {
        let formatter = NumberFormatter()
        formatter.numberStyle = .decimal
        formatter.roundingMode = roundingModel
        formatter.maximumFractionDigits = maximumFractionDigits
        formatter.minimumFractionDigits = minimumFractionDigits
        if self.contains(".") {
            // Êï¥Êï∞‰ΩçÊúÄÂ∞ë‰ΩçÊï∞
            formatter.minimumIntegerDigits = 1
        }
        var num = NSDecimalNumber(string: self)
        if num.doubleValue.isNaN {
            num = NSDecimalNumber(string: "0")
        }
        if let result = formatter.string(from: num) {
            return result
        }
        return self
    }
}

extension TestFileViewController {
    @objc func showAlertAgreement() {
        let title = "Áî®Êà∑ÂçèËÆÆÂíåÈöêÁßÅÊîøÁ≠ñ"
        
        let linkDic = ["„ÄäÁî®Êà∑ÂçèËÆÆ„Äã": "http://*",
                       "„ÄäÈöêÁßÅÊîøÁ≠ñ„Äã": "http://*",]
        
        let protocolPolicyContent = "\tÁî®Êà∑ÂçèËÆÆÂíåÈöêÁßÅÊîøÁ≠ñËØ∑ÊÇ®Âä°ÂøÖÂÆ°ÂÄºÈòÖËØª„ÄÅÂÖÖÂàÜÁêÜËß£ ‚ÄúÁî®Êà∑ÂçèËÆÆ‚Äù Âíå ÈöêÁßÅÊîøÁ≠ñ, ÂêÑÈ°πÊù°Ê¨æÔºåÂåÖÊã¨‰ΩÜ‰∏çÈôê‰∫éÔºö‰∏∫‰∫ÜÂêëÊÇ®Êèê‰æõÂç≥Êó∂ÈÄöËÆØ„ÄÅÂÜÖÂÆπÂàÜ‰∫´Á≠âÊúçÂä°ÔºåÊàë‰ª¨ÈúÄË¶ÅÊî∂ÈõÜÊÇ®ÁöÑËÆæÂ§á‰ø°ÊÅØ„ÄÅÊìç‰ΩúÊó•ÂøóÁ≠â‰∏™‰∫∫‰ø°ÊÅØ„ÄÇ\n\tÊÇ®ÂèØÈòÖËØª„ÄäÁî®Êà∑ÂçèËÆÆ„ÄãÂíå„ÄäÈöêÁßÅÊîøÁ≠ñ„Äã‰∫ÜËß£ËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇÂ¶ÇÊûúÊÇ®ÂêåÊÑèÔºåËØ∑ÁÇπÂáª ‚ÄúÂêåÊÑè‚Äù ÂºÄÂßãÊé•ÂèóÊàë‰ª¨ÁöÑÊúçÂä°;"
        
        let paraStyle = NSMutableParagraphStyle()
        // Âè≥ÂØπÈΩê
        paraStyle.alignment = .left
        let attributedText = NSMutableAttributedString.createHighlightRichText(content: protocolPolicyContent, highlightRichTexts: linkDic.allKeys(), contentTextColor: UIColor.brown, contentFont: UIFont.systemFont(ofSize: 15), highlightRichTextColor: UIColor.blue, highlightRichTextFont: UIFont.systemFont(ofSize: 15), paraStyle: paraStyle)
        
        let alertVC = UIAlertController(title: title, message: nil, preferredStyle: .alert)
            .addActionTitles(["ÂèñÊ∂à", "ÂêåÊÑè"]) { vc, action in
                debugPrint(action.title)
            }
        
        alertVC.setValue(attributedText, forKey: "attributedMessage")
        alertVC.messageLabel?.jk.addGestureTap { reco in
            (reco as? UITapGestureRecognizer)?.didTapLabelAttributedText(linkDic) {[weak self] text, url in
                guard let weakSelf = self else {
                    return
                }
                debugPrint("\(text), \(url ?? "_")")
                alertVC.dismiss(animated: true, completion: nil)
                let vc = JKVVViewController()
                vc.backClosure = {
                    weakSelf.present(alertVC, animated: true, completion: nil)
                }
                // vc.modalPresentationStyle = .overFullScreen
                weakSelf.navigationController?.pushViewController(vc, animated: true)
                //alertVC.present(UINavigationController(rootViewController: vc), animated: true, completion: nil)
            }
        }
        self.present(alertVC, animated: true, completion: nil)
    }
}


